<!DOCTYPE html>
<html>
<head>
    <title>YPG Scoreboard</title>
    <link rel="stylesheet" type="text/css" href="styles.css">

</head>
<body>
    <h1>YPG Scoreboard</h1>
    
    <div>
        <h2>Nations</h2>
        <ul>
            <li>Invincible: <span id="invincibleScore">0</span> points</li>
            <li>Unbeatable: <span id="unbeatableScore">0</span> points</li>
            <li>Flawless: <span id="flawlessScore">0</span> points</li>
            <li>Impact: <span id="impactScore">0</span> points</li>
        </ul>
    </div>
    
    <div>
        <h2>Update Points</h2>
        <form id="updateForm">
            <label for="nationSelect">Select Nation:</label>
            <select id="nationSelect">
                <option value="invincible">Invincible</option>
                <option value="unbeatable">Unbeatable</option>
                <option value="flawless">Flawless</option>
                <option value="impact">Impact</option>
            </select>
            <br>
            <label for="pointsInput">Points:</label>
            <input type="number" id="pointsInput" min="0">
            <br>
            <label for="passwordInput">Password:</label>
            <input type="password" id="passwordInput">
            <br>
            <button type="button" onclick="updatePoints()">Update</button>
        </form>
    </div>
    
    <div>
        <h2>Edit Points</h2>
        <form id="editForm">
            <label for="editNationSelect">Select Nation:</label>
            <select id="editNationSelect">
                <option value="invincible">Invincible</option>
                <option value="unbeatable">Unbeatable</option>
                <option value="flawless">Flawless</option>
                <option value="impact">Impact</option>
            </select>
            <br>
            <label for="editPointsInput">Edit Points:</label>
            <input type="number" id="editPointsInput" min="0">
            <br>
            <label for="editPasswordInput">Password:</label>
            <input type="password" id="editPasswordInput">
            <br>
            <button type="button" onclick="editPoints()">Edit</button>
        </form>
    </div>

    <script>

function fetchDataFromGitHub() {
    const githubDataUrl = 'https://raw.githubusercontent.com/PhilaniKemele/YPG-Scoreboard/main/scoreboard.json';

    fetch(githubDataUrl, { cache: 'no-store' })
        .then(response => response.json())
        .then(data => {
            document.getElementById("invincibleScore").textContent = data.invincible;
            document.getElementById("unbeatableScore").textContent = data.unbeatable;
            document.getElementById("flawlessScore").textContent = data.flawless;
            document.getElementById("impactScore").textContent = data.impact;
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

    document.addEventListener('DOMContentLoaded', fetchDataFromGitHub);

        function updatePoints() {
            const selectedNation = document.getElementById("nationSelect").value;
            const points = parseInt(document.getElementById("pointsInput").value);
            const password = document.getElementById("passwordInput").value;

            if (password === "YPG2023") {

                fetch('https://api.github.com/repos/PhilaniKemele/YPG-Scoreboard/contents/scoreboard.json')
                    .then(response => response.json())
                    .then(fileData => {

                        const latestSHA = fileData.sha;

                        fetch('https://raw.githubusercontent.com/PhilaniKemele/YPG-Scoreboard/main/scoreboard.json')
                            .then(response => response.json())
                            .then(data => {

                                data[selectedNation] += points;

                                fetch('https://api.github.com/repos/PhilaniKemele/YPG-Scoreboard/contents/scoreboard.json', {
                                    method: 'PUT',
                                    headers: {
                                        'Authorization': 'Bearer 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',
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        message: 'Update points for ' + selectedNation,
                                        content: btoa(JSON.stringify(data, null, 4)), 
                                        sha: latestSHA, 
                                    }),
                                })
                                    .then(response => {
                                        if (response.status === 200) {
                                            console.log('Points updated successfully');
                                            
                                            document.getElementById(selectedNation + "Score").textContent = data[selectedNation];
                                        } else {
                                            console.error('Failed to update points');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    })
                    .catch(error => {
                        console.error('Error fetching SHA:', error);
                    });
            } else {
                console.error('Invalid password');
            }
        }

        function editPoints() {
            const editSelectedNation = document.getElementById("editNationSelect").value;
            const editPoints = parseInt(document.getElementById("editPointsInput").value);
            const editPassword = document.getElementById("editPasswordInput").value;

            if (editPassword === "YPG2023") {

                fetch('https://api.github.com/repos/PhilaniKemele/YPG-Scoreboard/contents/scoreboard.json')
                    .then(response => response.json())
                    .then(fileData => {

                        const latestSHA = fileData.sha;

                        fetch('https://raw.githubusercontent.com/PhilaniKemele/YPG-Scoreboard/main/scoreboard.json')
                            .then(response => response.json())
                            .then(data => {

                                data[editSelectedNation] = editPoints;

                                fetch('https://api.github.com/repos/PhilaniKemele/YPG-Scoreboard/contents/scoreboard.json', {
                                    method: 'PUT',
                                    headers: {
                                        'Authorization': 'Bearer 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',
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        message: 'Edit points for ' + editSelectedNation,
                                        content: btoa(JSON.stringify(data, null, 4)), 
                                        sha: latestSHA, 
                                    }),
                                })
                                    .then(response => {
                                        if (response.status === 200) {
                                            console.log('Points edited successfully');
                                            
                                            document.getElementById(editSelectedNation + "Score").textContent = editPoints;
                                        } else {
                                            console.error('Failed to edit points');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                    })
                    .catch(error => {
                        console.error('Error fetching SHA:', error);
                    });
            } else {
                console.error('Invalid password');
            }
        }
    </script>
</body>
</html>